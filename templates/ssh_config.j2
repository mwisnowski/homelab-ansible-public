# SSH Config for Homelab - Generated by Ansible
# User: {{ ssh_user }}
# Generated: {{ ansible_date_time.iso8601 }}

# Global settings
Host *
    ServerAliveInterval 60
    ServerAliveCountMax 3
    StrictHostKeyChecking no
    UserKnownHostsFile {{ ssh_known_hosts_file }}
    IdentityFile {{ ssh_key_file }}

# Homelab hosts configuration
{% for host in groups['linux_hosts'] %}
{% if hostvars[host]['inventory_hostname'] != inventory_hostname %}
Host {{ hostvars[host]['inventory_hostname'] }}
    HostName {{ hostvars[host]['ansible_host'] }}
    User {{ ssh_user }}
    Port {{ hostvars[host]['ansible_port'] | default(22) }}
    IdentityFile {{ ssh_key_file }}

{% endif %}
{% endfor %}

# Host aliases (short names)
{% for host in groups['linux_hosts'] %}
{% if hostvars[host]['inventory_hostname'] != inventory_hostname %}
Host {{ hostvars[host]['inventory_hostname'].split('.')[0] }}
    HostName {{ hostvars[host]['ansible_host'] }}
    User {{ ssh_user }}
    Port {{ hostvars[host]['ansible_port'] | default(22) }}
    IdentityFile {{ ssh_key_file }}

{% endif %}
{% endfor %}

# IP-based access
{% for host in groups['linux_hosts'] %}
{% if hostvars[host]['inventory_hostname'] != inventory_hostname %}
Host {{ hostvars[host]['ansible_host'] }}
    HostName {{ hostvars[host]['ansible_host'] }}
    User {{ ssh_user }}
    Port {{ hostvars[host]['ansible_port'] | default(22) }}
    IdentityFile {{ ssh_key_file }}

{% endif %}
{% endfor %}
