[Unit]
Description=Prometheus Node Exporter
Documentation=https://prometheus.io/docs/guides/node-exporter/
Wants=network-online.target
After=network-online.target

[Service]
Type=simple
User={{ node_exporter_user }}
Group={{ node_exporter_group }}
ExecReload=/bin/kill -HUP $MAINPID
ExecStart={{ node_exporter_binary_path }} \
  --web.listen-address={{ node_exporter_web_listen_address }} \
  --web.max-requests={{ node_exporter_web_max_requests }} \
  --log.level={{ node_exporter_log_level }} \
  --log.format={{ node_exporter_log_format }}{% if node_exporter_web_disable_exporter_metrics %} \
  --web.disable-exporter-metrics{% endif %}{% for collector in node_exporter_enabled_collectors %} \
  --collector.{{ collector }}{% endfor %}{% for collector in node_exporter_disabled_collectors %} \
  --no-collector.{{ collector }}{% endfor %}{% for arg in node_exporter_extra_args %} \
  {{ arg }}{% endfor %}

SyslogIdentifier=node_exporter
Restart=always
RestartSec=1
StartLimitInterval=0

# Security settings
NoNewPrivileges=true
ProtectHome=true
ProtectSystem=strict
ProtectControlGroups=true
ProtectKernelModules=true
ProtectKernelTunables=true
LockPersonality=true
RestrictRealtime=true
RestrictSUIDSGID=true
RemoveIPC=true
RestrictNamespaces=true

# Allow reading system metrics
ReadOnlyPaths=/proc /sys
ReadWritePaths={{ node_exporter_config_dir }}

[Install]
WantedBy=multi-user.target
